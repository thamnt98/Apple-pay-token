<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Apple Pay Component</title>
    <script src="https://checkoutshopper-test.adyen.com/checkoutshopper/sdk/5.53.0/adyen.js"></script>
    <link rel="stylesheet" href="https://checkoutshopper-test.adyen.com/checkoutshopper/sdk/5.53.0/adyen.css" />
  </head>
  <body>
    <div id="applepay-container"></div>

    <script>
      async function init() {
        const { clientKey } = await fetch("/config").then((res) => res.json());
        const paymentMethodsResponse = await fetch("/paymentMethods", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
        }).then((res) => res.json());

        const checkout = await AdyenCheckout({
          environment: "test",
          clientKey,
          paymentMethodsResponse,
          onSubmit: async (state) => {
            const res = await fetch("/submit-payment", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ paymentData: state.data.paymentMethod }),
            });

            const result = await res.json();
            console.log("Webhook response:", result);
          },
        });

        checkout.create("applepay").mount("#applepay-container");
      }

      init();
    </script>
  </body>
</html>
